{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/hooks/useWebRTC.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useRef, useState, useCallback } from 'react';\r\nimport io, { Socket } from 'socket.io-client';\r\n\r\nconst STUN_SERVERS = {\r\n    iceServers: [\r\n        {\r\n            urls: [\r\n                \"stun:stun.l.google.com:19302\",\r\n                \"stun:global.stun.twilio.com:3478\",\r\n            ],\r\n        },\r\n    ],\r\n};\r\n\r\nexport type WebRTCStream = {\r\n    id: string;\r\n    stream: MediaStream;\r\n    isLocal?: boolean;\r\n};\r\n\r\nexport function useWebRTC(roomId: string) {\r\n    const [socket, setSocket] = useState<Socket | null>(null);\r\n    const [localStream, setLocalStream] = useState<MediaStream | null>(null);\r\n    const [peers, setPeers] = useState<WebRTCStream[]>([]);\r\n\r\n    const peersRef = useRef<{ [key: string]: RTCPeerConnection }>({});\r\n    const localStreamRef = useRef<MediaStream | null>(null);\r\n    const socketRef = useRef<Socket | null>(null);\r\n\r\n    // Helper to create a peer connection\r\n    const createPeer = useCallback((userId: string, initiator: boolean, stream: MediaStream, socket: Socket) => {\r\n        const pc = new RTCPeerConnection(STUN_SERVERS);\r\n        peersRef.current[userId] = pc;\r\n\r\n        // Add local tracks\r\n        stream.getTracks().forEach(track => {\r\n            pc.addTrack(track, stream);\r\n        });\r\n\r\n        // Handle ICE candidates\r\n        pc.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n                socket.emit('ice-candidate', {\r\n                    roomId,\r\n                    candidate: event.candidate,\r\n                    to: userId\r\n                });\r\n            }\r\n        };\r\n\r\n        // Handle remote stream\r\n        pc.ontrack = (event) => {\r\n            console.log(\"Received remote track from\", userId, \"Track kind:\", event.track.kind);\r\n            setPeers(prev => {\r\n                const existing = prev.find(p => p.id === userId);\r\n                if (existing) {\r\n                    console.log(\"Updating existing peer stream for\", userId);\r\n                    // Update the existing peer with new stream\r\n                    return prev.map(p => p.id === userId ? { ...p, stream: event.streams[0] } : p);\r\n                }\r\n                console.log(\"Adding new peer to state:\", userId);\r\n                return [...prev, { id: userId, stream: event.streams[0], isLocal: false }];\r\n            });\r\n        };\r\n\r\n        // Create Offer\r\n        if (initiator) {\r\n            console.log('Creating OFFER for peer:', userId);\r\n            pc.createOffer().then(offer => {\r\n                console.log('Offer created, setting local description');\r\n                return pc.setLocalDescription(offer);\r\n            }).then(() => {\r\n                console.log('Sending OFFER to:', userId);\r\n                socket.emit('offer', {\r\n                    roomId,\r\n                    sdp: pc.localDescription,\r\n                    to: userId,\r\n                    from: socket.id\r\n                });\r\n            }).catch(err => {\r\n                console.error('Error creating/sending offer:', err);\r\n            });\r\n        }\r\n\r\n        return pc;\r\n    }, [roomId]);\r\n\r\n    const [error, setError] = useState<Error | null>(null);\r\n    const [isConnected, setIsConnected] = useState(false);\r\n\r\n    // ... refs ...\r\n\r\n    // Same createPeer ...\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        const socketUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001';\r\n        console.log('Connecting to socket at:', socketUrl);\r\n\r\n        const s = io(socketUrl, {\r\n            path: '/socket.io',\r\n            transports: ['websocket', 'polling']\r\n        });\r\n        setSocket(s);\r\n        socketRef.current = s;\r\n\r\n        // Socket Connection Handlers\r\n        const onConnect = () => {\r\n            console.log('Socket connected with ID:', s.id);\r\n            console.log('Joining room:', roomId);\r\n            setIsConnected(true);\r\n            s.emit('join-room', roomId, s.id);\r\n        };\r\n\r\n        const onDisconnect = () => {\r\n            console.log('Socket disconnected');\r\n            setIsConnected(false);\r\n        };\r\n\r\n        if (s.connected) {\r\n            onConnect();\r\n        } else {\r\n            s.on('connect', onConnect);\r\n        }\r\n\r\n        s.on('disconnect', onDisconnect);\r\n\r\n        // Get Local Media\r\n        // Try with simple constraints first\r\n        navigator.mediaDevices.getUserMedia({\r\n            audio: true,\r\n            video: true // Removed 1280x720 constraint to rule out hardware incompatibility\r\n        }).then(stream => {\r\n            if (!isMounted) {\r\n                stream.getTracks().forEach(track => track.stop());\r\n                return;\r\n            }\r\n            setLocalStream(stream);\r\n            localStreamRef.current = stream;\r\n            // ... (rest of logic same) ...\r\n\r\n            // REMOVED: setPeers(prev => [...prev, { id: 'local', stream: stream, isLocal: true }]);\r\n            // We shouldn't add local stream to 'peers' state to avoid duplicates and sync issues.\r\n            // We will combine it in the hook return.\r\n\r\n            // Handled by onConnect above\r\n\r\n            // Socket Events\r\n            s.on('user-connected', (userId: string) => {\r\n                console.log('User connected event received for:', userId);\r\n                console.log('I am initiator, creating peer...');\r\n                createPeer(userId, true, stream, s);\r\n            });\r\n\r\n            s.on('offer', async (data) => {\r\n                console.log('Received OFFER from:', data.from);\r\n                const pc = createPeer(data.from, false, stream, s);\r\n                await pc.setRemoteDescription(new RTCSessionDescription(data.sdp));\r\n                console.log('Remote description set (Offer)');\r\n\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                console.log('Sending ANSWER to:', data.from);\r\n                s.emit('answer', { roomId, sdp: answer, to: data.from, from: s.id });\r\n            });\r\n\r\n            s.on('answer', async (data) => {\r\n                console.log('Received ANSWER from:', data.from);\r\n                const pc = peersRef.current[data.from];\r\n                if (pc) {\r\n                    await pc.setRemoteDescription(new RTCSessionDescription(data.sdp));\r\n                    console.log('Remote description set (Answer)');\r\n                } else {\r\n                    console.warn('Received Answer for unknown peer:', data.from);\r\n                }\r\n            });\r\n\r\n            s.on('ice-candidate', async (data) => {\r\n                const pc = peersRef.current[data.from];\r\n                if (pc && data.candidate) await pc.addIceCandidate(new RTCIceCandidate(data.candidate));\r\n            });\r\n\r\n            s.on('user-disconnected', (userId: string) => {\r\n                if (peersRef.current[userId]) {\r\n                    peersRef.current[userId].close();\r\n                    delete peersRef.current[userId];\r\n                }\r\n                setPeers(prev => prev.filter(p => p.id !== userId));\r\n            });\r\n\r\n        }).catch(err => {\r\n            console.error(\"Failed to get local media\", err);\r\n            setError(err);\r\n        });\r\n\r\n        return () => {\r\n            s.disconnect();\r\n            localStreamRef.current?.getTracks().forEach(t => t.stop());\r\n            Object.values(peersRef.current).forEach(pc => pc.close());\r\n        };\r\n    }, [roomId, createPeer]);\r\n\r\n    const [isAudioEnabled, setIsAudioEnabled] = useState(true);\r\n    const [isVideoEnabled, setIsVideoEnabled] = useState(true);\r\n\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const originalVideoTrackRef = useRef<MediaStreamTrack | null>(null);\r\n\r\n    const toggleAudio = useCallback(() => {\r\n        if (localStreamRef.current) {\r\n            const audioTrack = localStreamRef.current.getAudioTracks()[0];\r\n            if (audioTrack) {\r\n                audioTrack.enabled = !audioTrack.enabled;\r\n                setIsAudioEnabled(audioTrack.enabled);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    const toggleVideo = useCallback(() => {\r\n        if (localStreamRef.current) {\r\n            const videoTrack = localStreamRef.current.getVideoTracks()[0];\r\n            if (videoTrack) {\r\n                videoTrack.enabled = !videoTrack.enabled;\r\n                setIsVideoEnabled(videoTrack.enabled);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    const stopScreenShare = useCallback(async () => {\r\n        if (localStreamRef.current) {\r\n            // 1. Stop the screen share track to ensure the browser UI updates\r\n            const screenTrack = localStreamRef.current.getVideoTracks()[0];\r\n            if (screenTrack) {\r\n                screenTrack.stop();\r\n                localStreamRef.current.removeTrack(screenTrack);\r\n            }\r\n\r\n            try {\r\n                // 2. Re-acquire the camera stream\r\n                const newStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n                const newVideoTrack = newStream.getVideoTracks()[0];\r\n\r\n                // 3. Add the new camera track to the local stream\r\n                localStreamRef.current.addTrack(newVideoTrack);\r\n\r\n                // 4. Update all peer connections to send the new track\r\n                Object.values(peersRef.current).forEach(pc => {\r\n                    const sender = pc.getSenders().find(s => s.track?.kind === 'video');\r\n                    if (sender) {\r\n                        sender.replaceTrack(newVideoTrack);\r\n                    }\r\n                });\r\n\r\n                // 5. Update state\r\n                setIsScreenSharing(false);\r\n                originalVideoTrackRef.current = null;\r\n\r\n                // 6. Force UI update by creating a new MediaStream reference\r\n                // This ensures the video element srcObject gets refreshed\r\n                setLocalStream(new MediaStream(localStreamRef.current.getTracks()));\r\n\r\n            } catch (e) {\r\n                console.error(\"Failed to restore camera\", e);\r\n                // Fallback: Just update state so UI isn't stuck in \"sharing\" mode\r\n                setIsScreenSharing(false);\r\n            }\r\n        }\r\n    }, [roomId]);\r\n\r\n\r\n    const shareScreen = useCallback(async () => {\r\n        try {\r\n            const screenStream = await navigator.mediaDevices.getDisplayMedia({\r\n                video: true,\r\n                audio: false\r\n            });\r\n            const screenTrack = screenStream.getVideoTracks()[0];\r\n\r\n            if (localStreamRef.current) {\r\n                const currentVideoTrack = localStreamRef.current.getVideoTracks()[0];\r\n                if (currentVideoTrack) {\r\n                    originalVideoTrackRef.current = currentVideoTrack;\r\n                    currentVideoTrack.stop();\r\n                    localStreamRef.current.removeTrack(currentVideoTrack);\r\n                    localStreamRef.current.addTrack(screenTrack);\r\n\r\n                    Object.values(peersRef.current).forEach(pc => {\r\n                        const sender = pc.getSenders().find(s => s.track?.kind === 'video');\r\n                        if (sender) {\r\n                            sender.replaceTrack(screenTrack);\r\n                        }\r\n                    });\r\n\r\n                    screenTrack.onended = () => {\r\n                        stopScreenShare();\r\n                    };\r\n\r\n                    setIsScreenSharing(true);\r\n                    setLocalStream(new MediaStream(localStreamRef.current.getTracks()));\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to share screen\", err);\r\n        }\r\n    }, [stopScreenShare]);\r\n\r\n    // Combine local stream with remote peers for the UI\r\n    const allPeers = localStream\r\n        ? [{ id: 'local', stream: localStream, isLocal: true }, ...peers]\r\n        : peers;\r\n\r\n    return { localStream, peers: allPeers, socket, error, toggleAudio, toggleVideo, isAudioEnabled, isVideoEnabled, shareScreen, stopScreenShare, isScreenSharing, isConnected };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 410, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/components/ui/Card.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { motion, HTMLMotionProps } from 'framer-motion';\r\nimport { clsx, type ClassValue } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\n\r\nfunction cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n\r\nexport function Card({ className, children, ...props }: HTMLMotionProps<\"div\">) {\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            whileInView={{ opacity: 1, y: 0 }}\r\n            viewport={{ once: true }}\r\n            className={cn(\r\n                'bg-white/80 dark:bg-zinc-900/80 backdrop-blur-xl border border-white/20 dark:border-white/5 rounded-2xl shadow-xl p-6',\r\n                className\r\n            )}\r\n            {...props}\r\n        >\r\n            {children}\r\n        </motion.div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,SAAS,GAAG,GAAG,MAAoB;IAC/B,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACxB;AAEO,SAAS,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAA+B;IAC1E,qBACI,8OAAC,oMAAM,CAAC,GAAG;QACP,SAAS;YAAE,SAAS;YAAG,GAAG;QAAG;QAC7B,aAAa;YAAE,SAAS;YAAG,GAAG;QAAE;QAChC,UAAU;YAAE,MAAM;QAAK;QACvB,WAAW,GACP,yHACA;QAEH,GAAG,KAAK;kBAER;;;;;;AAGb"}},
    {"offset": {"line": 452, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/components/studio/VideoGrid.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { User } from 'lucide-react';\r\nimport { Card } from '@/components/ui/Card';\r\nimport type { WebRTCStream } from '@/hooks/useWebRTC';\r\n\r\ninterface VideoGridProps {\r\n    peers: WebRTCStream[];\r\n}\r\n\r\nexport function VideoGrid({ peers }: VideoGridProps) {\r\n    return (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full h-full p-6\">\r\n            {peers.map((peer) => (\r\n                <VideoPlayer key={peer.id} stream={peer.stream} isLocal={peer.isLocal} id={peer.id} />\r\n            ))}\r\n            {peers.length === 0 && (\r\n                <div className=\"col-span-full flex items-center justify-center h-64 text-gray-400\">\r\n                    <p>Connecting to studio...</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction VideoPlayer({ stream, isLocal, id }: { stream: MediaStream; isLocal?: boolean; id: string }) {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (videoRef.current && stream) {\r\n            videoRef.current.srcObject = stream;\r\n        }\r\n    }, [stream]);\r\n\r\n    return (\r\n        <Card className=\"relative overflow-hidden aspect-video p-0 bg-black border-none group\">\r\n            <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                playsInline\r\n                muted={isLocal} // Mute local to prevent feedback\r\n                className=\"w-full h-full object-cover rounded-xl\"\r\n            />\r\n            <div className=\"absolute bottom-4 left-4 bg-black/50 backdrop-blur-md px-3 py-1 rounded-full text-white text-sm font-medium flex items-center gap-2\">\r\n                <User className=\"w-4 h-4\" />\r\n                {isLocal ? 'You' : `Peer ${id.substr(0, 4)}`}\r\n            </div>\r\n            {/* Audio Indicator (Simple visual) */}\r\n            <div className=\"absolute top-4 right-4 bg-green-500/80 p-1.5 rounded-full\" />\r\n        </Card>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AALA;;;;;AAYO,SAAS,UAAU,EAAE,KAAK,EAAkB;IAC/C,qBACI,8OAAC;QAAI,WAAU;;YACV,MAAM,GAAG,CAAC,CAAC,qBACR,8OAAC;oBAA0B,QAAQ,KAAK,MAAM;oBAAE,SAAS,KAAK,OAAO;oBAAE,IAAI,KAAK,EAAE;mBAAhE,KAAK,EAAE;;;;;YAE5B,MAAM,MAAM,KAAK,mBACd,8OAAC;gBAAI,WAAU;0BACX,cAAA,8OAAC;8BAAE;;;;;;;;;;;;;;;;;AAKvB;AAEA,SAAS,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,EAA0D;IAChG,MAAM,WAAW,IAAA,+MAAM,EAAmB;IAE1C,IAAA,kNAAS,EAAC;QACN,IAAI,SAAS,OAAO,IAAI,QAAQ;YAC5B,SAAS,OAAO,CAAC,SAAS,GAAG;QACjC;IACJ,GAAG;QAAC;KAAO;IAEX,qBACI,8OAAC,wIAAI;QAAC,WAAU;;0BACZ,8OAAC;gBACG,KAAK;gBACL,QAAQ;gBACR,WAAW;gBACX,OAAO;gBACP,WAAU;;;;;;0BAEd,8OAAC;gBAAI,WAAU;;kCACX,8OAAC,0MAAI;wBAAC,WAAU;;;;;;oBACf,UAAU,QAAQ,CAAC,KAAK,EAAE,GAAG,MAAM,CAAC,GAAG,IAAI;;;;;;;0BAGhD,8OAAC;gBAAI,WAAU;;;;;;;;;;;;AAG3B"}},
    {"offset": {"line": 557, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/hooks/useFFmpeg.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { FFmpeg } from '@ffmpeg/ffmpeg';\r\nimport { toBlobURL } from '@ffmpeg/util';\r\n\r\nexport function useFFmpeg() {\r\n    const [loaded, setLoaded] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const ffmpegRef = useRef(new FFmpeg());\r\n    const messageRef = useRef<HTMLParagraphElement | null>(null);\r\n\r\n    const load = async () => {\r\n        setIsLoading(true);\r\n        const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd';\r\n        const ffmpeg = ffmpegRef.current;\r\n\r\n        ffmpeg.on('log', ({ message }) => {\r\n            console.log(message);\r\n            if (messageRef.current) messageRef.current.innerHTML = message;\r\n        });\r\n\r\n        try {\r\n            await ffmpeg.load({\r\n                coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),\r\n                wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),\r\n            });\r\n            setLoaded(true);\r\n        } catch (error) {\r\n            console.error(\"FFmpeg load failed:\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        load();\r\n    }, []);\r\n\r\n    return { ffmpeg: ffmpegRef.current, loaded, isLoading, messageRef };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAMO,SAAS;IACZ,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,YAAY,IAAA,+MAAM,EAAC,IAAI,qKAAM;IACnC,MAAM,aAAa,IAAA,+MAAM,EAA8B;IAEvD,MAAM,OAAO;QACT,aAAa;QACb,MAAM,UAAU;QAChB,MAAM,SAAS,UAAU,OAAO;QAEhC,OAAO,EAAE,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE;YACzB,QAAQ,GAAG,CAAC;YACZ,IAAI,WAAW,OAAO,EAAE,WAAW,OAAO,CAAC,SAAS,GAAG;QAC3D;QAEA,IAAI;YACA,MAAM,OAAO,IAAI,CAAC;gBACd,SAAS,MAAM,IAAA,qKAAS,EAAC,GAAG,QAAQ,eAAe,CAAC,EAAE;gBACtD,SAAS,MAAM,IAAA,qKAAS,EAAC,GAAG,QAAQ,iBAAiB,CAAC,EAAE;YAC5D;YACA,UAAU;QACd,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uBAAuB;QACzC,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,IAAA,kNAAS,EAAC;QACN;IACJ,GAAG,EAAE;IAEL,OAAO;QAAE,QAAQ,UAAU,OAAO;QAAE;QAAQ;QAAW;IAAW;AACtE"}},
    {"offset": {"line": 607, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/components/ui/Button.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { motion, HTMLMotionProps } from 'framer-motion';\r\nimport { Loader2 } from 'lucide-react';\r\nimport { clsx, type ClassValue } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\n\r\nfunction cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n\r\nimport React from 'react';\r\n\r\ninterface ButtonProps extends HTMLMotionProps<\"button\"> {\r\n    variant?: 'primary' | 'secondary' | 'ghost' | 'danger';\r\n    size?: 'sm' | 'md' | 'lg';\r\n    isLoading?: boolean;\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport function Button({\r\n    className,\r\n    variant = 'primary',\r\n    size = 'md',\r\n    isLoading,\r\n    children,\r\n    disabled,\r\n    ...props\r\n}: ButtonProps) {\r\n    const variants = {\r\n        primary: 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-500/25',\r\n        secondary: 'bg-white dark:bg-zinc-800 text-gray-900 dark:text-white border border-gray-200 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-700',\r\n        ghost: 'bg-transparent hover:bg-black/5 dark:hover:bg-white/5 text-gray-700 dark:text-gray-300',\r\n        danger: 'bg-red-500 text-white hover:bg-red-600 shadow-lg shadow-red-500/25',\r\n    };\r\n\r\n    const sizes = {\r\n        sm: 'px-3 py-1.5 text-xs',\r\n        md: 'px-5 py-2.5 text-sm',\r\n        lg: 'px-8 py-3.5 text-base',\r\n    };\r\n\r\n    return (\r\n        <motion.button\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            className={cn(\r\n                'inline-flex items-center justify-center rounded-xl font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:pointer-events-none',\r\n                variants[variant],\r\n                sizes[size],\r\n                className\r\n            )}\r\n            disabled={disabled || isLoading}\r\n            {...props}\r\n        >\r\n            {isLoading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n            {children}\r\n        </motion.button>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOA,SAAS,GAAG,GAAG,MAAoB;IAC/B,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACxB;AAWO,SAAS,OAAO,EACnB,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,IAAI,EACX,SAAS,EACT,QAAQ,EACR,QAAQ,EACR,GAAG,OACO;IACV,MAAM,WAAW;QACb,SAAS;QACT,WAAW;QACX,OAAO;QACP,QAAQ;IACZ;IAEA,MAAM,QAAQ;QACV,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IAEA,qBACI,8OAAC,oMAAM,CAAC,MAAM;QACV,YAAY;YAAE,OAAO;QAAK;QAC1B,UAAU;YAAE,OAAO;QAAK;QACxB,WAAW,GACP,0NACA,QAAQ,CAAC,QAAQ,EACjB,KAAK,CAAC,KAAK,EACX;QAEJ,UAAU,YAAY;QACrB,GAAG,KAAK;;YAER,2BAAa,8OAAC,4NAAO;gBAAC,WAAU;;;;;;YAChC;;;;;;;AAGb"}},
    {"offset": {"line": 667, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/app/actions/gemini.ts"],"sourcesContent":["'use server';\r\n\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { GoogleAIFileManager } from '@google/generative-ai/server';\r\nimport { writeFile, unlink } from 'fs/promises';\r\nimport { join } from 'path';\r\nimport { tmpdir } from 'os';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n// Helper to save buffer to temp file\r\nasync function saveToTemp(buffer: Buffer): Promise<string> {\r\n    const filename = `upload-${uuidv4()}.webm`;\r\n    const filepath = join(tmpdir(), filename);\r\n    await writeFile(filepath, buffer);\r\n    return filepath;\r\n}\r\n\r\nexport async function processVideoWithGemini(formData: FormData, apiKey: string, modelName: string, prompt: string) {\r\n    if (!apiKey) throw new Error(\"API Key is required\");\r\n\r\n    const file = formData.get('file') as File;\r\n    if (!file) throw new Error(\"No file uploaded\");\r\n\r\n    try {\r\n        const fileManager = new GoogleAIFileManager(apiKey);\r\n        const genAI = new GoogleGenerativeAI(apiKey);\r\n\r\n        // 1. Save to temp disk (FileManager needs local path)\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n        const tempPath = await saveToTemp(buffer);\r\n\r\n        // 2. Upload to Google AI\r\n        const uploadResult = await fileManager.uploadFile(tempPath, {\r\n            mimeType: file.type || 'video/webm',\r\n            displayName: \"Studio Recording\",\r\n        });\r\n\r\n        // 3. Wait for processing (Video takes time)\r\n        let fileState = await fileManager.getFile(uploadResult.file.name);\r\n        while (fileState.state === 'PROCESSING') {\r\n            await new Promise(resolve => setTimeout(resolve, 2000));\r\n            fileState = await fileManager.getFile(uploadResult.file.name);\r\n        }\r\n\r\n        if (fileState.state === 'FAILED') {\r\n            throw new Error(\"Video processing failed.\");\r\n        }\r\n\r\n        // 4. Generate Content\r\n        const model = genAI.getGenerativeModel({ model: modelName || \"gemini-1.5-flash-latest\" });\r\n        const result = await model.generateContent([\r\n            prompt,\r\n            {\r\n                fileData: {\r\n                    fileUri: uploadResult.file.uri,\r\n                    mimeType: uploadResult.file.mimeType,\r\n                },\r\n            },\r\n        ]);\r\n\r\n        // Cleanup\r\n        await unlink(tempPath).catch(e => console.error(\"Temp cleanup failed\", e));\r\n        // await fileManager.deleteFile(uploadResult.file.name); // Optional: keep for cache or delete\r\n\r\n        return result.response.text();\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Gemini Error:\", error);\r\n        throw new Error(error.message || \"AI processing failed\");\r\n    }\r\n}\r\n\r\nexport async function listGeminiModels(apiKey: string) {\r\n    if (!apiKey) return [];\r\n\r\n    try {\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);\r\n        if (!response.ok) {\r\n            console.error(\"Failed to list models\", await response.text());\r\n            return [];\r\n        }\r\n\r\n        const data = await response.json();\r\n        if (!data.models) return [];\r\n\r\n        // Filter for models that support content generation and are stable/latest\r\n        return data.models\r\n            .filter((m: any) => m.supportedGenerationMethods?.includes(\"generateContent\"))\r\n            .map((m: any) => ({\r\n                name: m.name.replace('models/', ''),\r\n                displayName: m.displayName\r\n            }));\r\n    } catch (error) {\r\n        console.error(\"List Models Error:\", error);\r\n        return [];\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAiBsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 681, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/app/actions/gemini.ts"],"sourcesContent":["'use server';\r\n\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { GoogleAIFileManager } from '@google/generative-ai/server';\r\nimport { writeFile, unlink } from 'fs/promises';\r\nimport { join } from 'path';\r\nimport { tmpdir } from 'os';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n// Helper to save buffer to temp file\r\nasync function saveToTemp(buffer: Buffer): Promise<string> {\r\n    const filename = `upload-${uuidv4()}.webm`;\r\n    const filepath = join(tmpdir(), filename);\r\n    await writeFile(filepath, buffer);\r\n    return filepath;\r\n}\r\n\r\nexport async function processVideoWithGemini(formData: FormData, apiKey: string, modelName: string, prompt: string) {\r\n    if (!apiKey) throw new Error(\"API Key is required\");\r\n\r\n    const file = formData.get('file') as File;\r\n    if (!file) throw new Error(\"No file uploaded\");\r\n\r\n    try {\r\n        const fileManager = new GoogleAIFileManager(apiKey);\r\n        const genAI = new GoogleGenerativeAI(apiKey);\r\n\r\n        // 1. Save to temp disk (FileManager needs local path)\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n        const tempPath = await saveToTemp(buffer);\r\n\r\n        // 2. Upload to Google AI\r\n        const uploadResult = await fileManager.uploadFile(tempPath, {\r\n            mimeType: file.type || 'video/webm',\r\n            displayName: \"Studio Recording\",\r\n        });\r\n\r\n        // 3. Wait for processing (Video takes time)\r\n        let fileState = await fileManager.getFile(uploadResult.file.name);\r\n        while (fileState.state === 'PROCESSING') {\r\n            await new Promise(resolve => setTimeout(resolve, 2000));\r\n            fileState = await fileManager.getFile(uploadResult.file.name);\r\n        }\r\n\r\n        if (fileState.state === 'FAILED') {\r\n            throw new Error(\"Video processing failed.\");\r\n        }\r\n\r\n        // 4. Generate Content\r\n        const model = genAI.getGenerativeModel({ model: modelName || \"gemini-1.5-flash-latest\" });\r\n        const result = await model.generateContent([\r\n            prompt,\r\n            {\r\n                fileData: {\r\n                    fileUri: uploadResult.file.uri,\r\n                    mimeType: uploadResult.file.mimeType,\r\n                },\r\n            },\r\n        ]);\r\n\r\n        // Cleanup\r\n        await unlink(tempPath).catch(e => console.error(\"Temp cleanup failed\", e));\r\n        // await fileManager.deleteFile(uploadResult.file.name); // Optional: keep for cache or delete\r\n\r\n        return result.response.text();\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Gemini Error:\", error);\r\n        throw new Error(error.message || \"AI processing failed\");\r\n    }\r\n}\r\n\r\nexport async function listGeminiModels(apiKey: string) {\r\n    if (!apiKey) return [];\r\n\r\n    try {\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);\r\n        if (!response.ok) {\r\n            console.error(\"Failed to list models\", await response.text());\r\n            return [];\r\n        }\r\n\r\n        const data = await response.json();\r\n        if (!data.models) return [];\r\n\r\n        // Filter for models that support content generation and are stable/latest\r\n        return data.models\r\n            .filter((m: any) => m.supportedGenerationMethods?.includes(\"generateContent\"))\r\n            .map((m: any) => ({\r\n                name: m.name.replace('models/', ''),\r\n                displayName: m.displayName\r\n            }));\r\n    } catch (error) {\r\n        console.error(\"List Models Error:\", error);\r\n        return [];\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAyEsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 695, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/components/studio/AIAssistant.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/Button';\r\nimport { Card } from '@/components/ui/Card';\r\nimport { Sparkles, FileText, Film, Loader2, Key } from 'lucide-react';\r\nimport { processVideoWithGemini, listGeminiModels } from '@/app/actions/gemini';\r\n\r\ninterface AIAssistantProps {\r\n    recordedChunks: Blob[];\r\n}\r\n\r\nexport function AIAssistant({ recordedChunks }: AIAssistantProps) {\r\n    const [apiKey, setApiKey] = useState('');\r\n    const [showKeyInput, setShowKeyInput] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [result, setResult] = useState<string | null>(null);\r\n    const [model, setModel] = useState('gemini-1.5-flash-002');\r\n    const [activeTab, setActiveTab] = useState<'summary' | 'clips'>('summary');\r\n    const [availableModels, setAvailableModels] = useState<{ name: string, displayName: string }[]>([]);\r\n\r\n    useEffect(() => {\r\n        const key = apiKey || process.env.NEXT_PUBLIC_GEMINI_API_KEY;\r\n        if (key) {\r\n            listGeminiModels(key).then(models => {\r\n                if (models.length > 0) {\r\n                    setAvailableModels(models);\r\n                    // Check if current model is in list, if not set to first valid one or keep default if looks like a valid alias\r\n                    // For now, let's stick to our default if it exists, or update if user prefers.\r\n                    // But actually, seeing the list is better.\r\n                }\r\n            });\r\n        }\r\n    }, [apiKey]);\r\n\r\n    const handleAction = async (type: 'summary' | 'clips') => {\r\n        if (!apiKey && !process.env.NEXT_PUBLIC_GEMINI_API_KEY) {\r\n            setShowKeyInput(true);\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        setResult(null);\r\n        setActiveTab(type);\r\n\r\n        const key = apiKey || process.env.NEXT_PUBLIC_GEMINI_API_KEY || '';\r\n        const prompt = type === 'summary'\r\n            ? \"Generate a catchy Title, a short abstract/summary for social media, and 5 hashtags for this video.\"\r\n            : \"Analyze this video and identify 3 potential viral highlight clips. Return JSON format with { start: 'MM:SS', end: 'MM:SS', description: 'string' } for each clip.\";\r\n\r\n        try {\r\n            const blob = new Blob(recordedChunks, { type: 'video/webm' });\r\n            const formData = new FormData();\r\n            formData.append('file', blob, 'recording.webm');\r\n\r\n            const text = await processVideoWithGemini(formData, key, model, prompt);\r\n            setResult(text);\r\n        } catch (err: any) {\r\n            setResult(`Error: ${err.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className=\"bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-zinc-900 dark:to-zinc-900 border-indigo-100 dark:border-indigo-900/30\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-lg font-bold flex items-center gap-2 bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600\">\r\n                    <Sparkles className=\"w-5 h-5 text-indigo-500\" />\r\n                    AI Assistant\r\n                </h3>\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowKeyInput(!showKeyInput)} className=\"text-xs text-gray-400\">\r\n                    <Key className=\"w-3 h-3 mr-1\" /> {apiKey ? 'Key Set' : 'Set Key'}\r\n                </Button>\r\n            </div>\r\n\r\n            {showKeyInput && (\r\n                <div className=\"mb-4\">\r\n                    <input\r\n                        type=\"password\"\r\n                        placeholder=\"Enter Gemini API Key\"\r\n                        value={apiKey}\r\n                        onChange={(e) => setApiKey(e.target.value)}\r\n                        className=\"w-full p-2 text-sm rounded border dark:bg-zinc-800 dark:border-white/10\"\r\n                    />\r\n                    <p className=\"text-[10px] text-gray-500 mt-1\">\r\n                        Key is used locally and sent to Google servers. Get one at aistudio.google.com\r\n                    </p>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"mb-4\">\r\n                <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 block\">\r\n                    Model {availableModels.length > 0 ? `(${availableModels.length} available)` : ''}\r\n                </label>\r\n                <select\r\n                    value={model}\r\n                    onChange={(e) => setModel(e.target.value)}\r\n                    className=\"w-full p-2 text-sm rounded border bg-white dark:bg-zinc-800 dark:border-white/10\"\r\n                >\r\n                    {/* Default/Fallback Options if API fetch fails or hasn't happened yet */}\r\n                    {availableModels.length === 0 && (\r\n                        <>\r\n                            <option value=\"gemini-1.5-flash-002\">Gemini 1.5 Flash (Fastest - 002)</option>\r\n                            <option value=\"gemini-1.5-pro-002\">Gemini 1.5 Pro (Smartest - 002)</option>\r\n                            <option value=\"gemini-2.0-flash-exp\">Gemini 2.0 Flash Exp (Experimental)</option>\r\n                        </>\r\n                    )}\r\n\r\n                    {/* Dynamic Options */}\r\n                    {availableModels.map((m) => (\r\n                        <option key={m.name} value={m.name}>\r\n                            {m.displayName}\r\n                        </option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2 mb-4\">\r\n                <Button\r\n                    onClick={() => handleAction('summary')}\r\n                    disabled={loading || recordedChunks.length === 0}\r\n                    className=\"flex-1 bg-white dark:bg-zinc-800 text-indigo-600 shadow-sm border border-indigo-100 dark:border-indigo-900/50 hover:bg-indigo-50\"\r\n                >\r\n                    <FileText className=\"w-4 h-4 mr-2\" /> Show Notes\r\n                </Button>\r\n                <Button\r\n                    onClick={() => handleAction('clips')}\r\n                    disabled={loading || recordedChunks.length === 0}\r\n                    className=\"flex-1 bg-white dark:bg-zinc-800 text-purple-600 shadow-sm border border-purple-100 dark:border-purple-900/50 hover:bg-purple-50\"\r\n                >\r\n                    <Film className=\"w-4 h-4 mr-2\" /> Find Clips\r\n                </Button>\r\n            </div>\r\n\r\n            {loading && (\r\n                <div className=\"py-8 text-center text-gray-500 flex flex-col items-center gap-2 animate-pulse\">\r\n                    <Loader2 className=\"w-6 h-6 animate-spin text-indigo-500\" />\r\n                    <p className=\"text-xs\">Watching video & thinking...</p>\r\n                </div>\r\n            )}\r\n\r\n            {result && !loading && (\r\n                <div className=\"bg-white/50 dark:bg-black/20 p-4 rounded-lg text-sm whitespace-pre-wrap font-mono max-h-60 overflow-y-auto border border-gray-100 dark:border-white/5\">\r\n                    {result}\r\n                </div>\r\n            )}\r\n        </Card>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 997, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/components/studio/Editor.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useFFmpeg } from '@/hooks/useFFmpeg';\r\nimport { Button } from '@/components/ui/Button';\r\nimport { Card } from '@/components/ui/Card';\r\nimport { Play, Pause, Scissors, Download, Loader2 } from 'lucide-react';\r\nimport { AIAssistant } from './AIAssistant';\r\n\r\ninterface EditorProps {\r\n    recordedChunks: Blob[];\r\n}\r\n\r\nexport function Editor({ recordedChunks }: EditorProps) {\r\n    const { ffmpeg, loaded, isLoading } = useFFmpeg();\r\n    const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (recordedChunks.length > 0) {\r\n            const blob = new Blob(recordedChunks, { type: 'video/webm' });\r\n            const url = URL.createObjectURL(blob);\r\n            setVideoUrl(url);\r\n            return () => URL.revokeObjectURL(url);\r\n        }\r\n    }, [recordedChunks]);\r\n\r\n    const handlePlayPause = () => {\r\n        if (videoRef.current) {\r\n            if (isPlaying) {\r\n                videoRef.current.pause();\r\n            } else {\r\n                videoRef.current.play();\r\n            }\r\n            setIsPlaying(!isPlaying);\r\n        }\r\n    };\r\n\r\n    const processVideo = async () => {\r\n        if (!loaded) return;\r\n\r\n        try {\r\n            const videoBlob = new Blob(recordedChunks, { type: 'video/webm' });\r\n            const videoData = await videoBlob.arrayBuffer();\r\n\r\n            // Write file to FFmpeg's virtual file system\r\n            await ffmpeg.writeFile('input.webm', new Uint8Array(videoData));\r\n\r\n            // Transcode to MP4 \r\n            // -c:v copy: Copy video stream (likely VP9) to MP4 container.\r\n            // -c:a aac: Re-encode audio to AAC for compatibility.\r\n            // -strict experimental: Often needed for aac in some ffmpeg versions (though usually fine in recent ones).\r\n            await ffmpeg.exec(['-i', 'input.webm', '-c:v', 'copy', '-c:a', 'aac', 'output.mp4']);\r\n\r\n            // Read the result\r\n            const data = await ffmpeg.readFile('output.mp4');\r\n\r\n            // Download\r\n            const url = URL.createObjectURL(new Blob([data as any], { type: 'video/mp4' }));\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = 'record-final.mp4';\r\n            a.click();\r\n\r\n            // Cleanup\r\n            await ffmpeg.deleteFile('input.webm');\r\n            await ffmpeg.deleteFile('output.mp4');\r\n            URL.revokeObjectURL(url);\r\n\r\n        } catch (error) {\r\n            console.error(\"Processing failed\", error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className=\"w-full flex flex-col gap-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-lg font-bold\">Studio Editor</h3>\r\n                {isLoading && <span className=\"text-sm text-yellow-500 flex gap-2 items-center\"><Loader2 className=\"animate-spin w-4 h-4\" /> Loading Engine...</span>}\r\n                {loaded && <span className=\"text-sm text-green-500\">Engine Ready</span>}\r\n            </div>\r\n\r\n            <div className=\"aspect-video bg-black rounded-xl overflow-hidden relative group\">\r\n                {videoUrl ? (\r\n                    <video\r\n                        ref={videoRef}\r\n                        src={videoUrl}\r\n                        className=\"w-full h-full object-contain\"\r\n                        onEnded={() => setIsPlaying(false)}\r\n                    />\r\n                ) : (\r\n                    <div className=\"flex items-center justify-center h-full text-gray-500\">\r\n                        No Recording Yet\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Timeline / Controls */}\r\n            <div className=\"flex items-center gap-4\">\r\n                <Button onClick={handlePlayPause} disabled={!videoUrl} size=\"sm\" variant=\"secondary\">\r\n                    {isPlaying ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\r\n                </Button>\r\n                <div className=\"flex-1 h-12 bg-gray-100 dark:bg-zinc-800 rounded-lg relative overflow-hidden\">\r\n                    {/* Mock Timeline Track */}\r\n                    <div className=\"absolute inset-y-2 left-2 right-2 bg-indigo-500/20 rounded\"></div>\r\n                    {/* Playhead */}\r\n                    <div className=\"absolute top-0 bottom-0 left-[10%] w-0.5 bg-red-500\"></div>\r\n                </div>\r\n                <Button onClick={processVideo} disabled={!loaded || !videoUrl} size=\"sm\" variant=\"secondary\">\r\n                    <Scissors className=\"w-4 h-4 mr-2\" /> Trim\r\n                </Button>\r\n                <Button disabled={!videoUrl} size=\"sm\" variant=\"primary\">\r\n                    <Download className=\"w-4 h-4 mr-2\" /> Export\r\n                </Button>\r\n            </div>\r\n            {/* AI Assistant */}\r\n            <div className=\"pt-4 border-t border-gray-100 dark:border-white/5\">\r\n                <AIAssistant recordedChunks={recordedChunks} />\r\n            </div>\r\n        </Card>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1277, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/hooks/useRecorder.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useCallback } from 'react';\r\n\r\nexport function useRecorder() {\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [recordedChunks, setRecordedChunks] = useState<Blob[]>([]);\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n\r\n    const startRecording = useCallback((stream: MediaStream) => {\r\n        if (!stream) return;\r\n\r\n        setRecordedChunks([]);\r\n        setRecordedChunks([]);\r\n\r\n        let mimeType = 'video/webm; codecs=vp9,opus';\r\n        if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n            mimeType = 'video/webm; codecs=vp9'; // Fallback\r\n            if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n                mimeType = 'video/webm'; // Generic fallback\r\n            }\r\n        }\r\n\r\n        const mediaRecorder = new MediaRecorder(stream, {\r\n            mimeType\r\n        });\r\n\r\n        mediaRecorderRef.current = mediaRecorder;\r\n\r\n        mediaRecorder.ondataavailable = (event) => {\r\n            if (event.data.size > 0) {\r\n                setRecordedChunks((prev) => [...prev, event.data]);\r\n            }\r\n        };\r\n\r\n        mediaRecorder.start(1000); // Collect 1s chunks\r\n        setIsRecording(true);\r\n    }, []);\r\n\r\n    const stopRecording = useCallback(() => {\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n        }\r\n    }, []);\r\n\r\n    const getBlob = useCallback(() => {\r\n        return new Blob(recordedChunks, { type: 'video/webm' });\r\n    }, [recordedChunks]);\r\n\r\n    return {\r\n        isRecording,\r\n        startRecording,\r\n        stopRecording,\r\n        recordedChunks,\r\n        getBlob\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAIO,SAAS;IACZ,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAS,EAAE;IAC/D,MAAM,mBAAmB,IAAA,+MAAM,EAAuB;IAEtD,MAAM,iBAAiB,IAAA,oNAAW,EAAC,CAAC;QAChC,IAAI,CAAC,QAAQ;QAEb,kBAAkB,EAAE;QACpB,kBAAkB,EAAE;QAEpB,IAAI,WAAW;QACf,IAAI,CAAC,cAAc,eAAe,CAAC,WAAW;YAC1C,WAAW,0BAA0B,WAAW;YAChD,IAAI,CAAC,cAAc,eAAe,CAAC,WAAW;gBAC1C,WAAW,cAAc,mBAAmB;YAChD;QACJ;QAEA,MAAM,gBAAgB,IAAI,cAAc,QAAQ;YAC5C;QACJ;QAEA,iBAAiB,OAAO,GAAG;QAE3B,cAAc,eAAe,GAAG,CAAC;YAC7B,IAAI,MAAM,IAAI,CAAC,IAAI,GAAG,GAAG;gBACrB,kBAAkB,CAAC,OAAS;2BAAI;wBAAM,MAAM,IAAI;qBAAC;YACrD;QACJ;QAEA,cAAc,KAAK,CAAC,OAAO,oBAAoB;QAC/C,eAAe;IACnB,GAAG,EAAE;IAEL,MAAM,gBAAgB,IAAA,oNAAW,EAAC;QAC9B,IAAI,iBAAiB,OAAO,IAAI,iBAAiB,OAAO,CAAC,KAAK,KAAK,aAAa;YAC5E,iBAAiB,OAAO,CAAC,IAAI;YAC7B,eAAe;QACnB;IACJ,GAAG,EAAE;IAEL,MAAM,UAAU,IAAA,oNAAW,EAAC;QACxB,OAAO,IAAI,KAAK,gBAAgB;YAAE,MAAM;QAAa;IACzD,GAAG;QAAC;KAAe;IAEnB,OAAO;QACH;QACA;QACA;QACA;QACA;IACJ;AACJ"}},
    {"offset": {"line": 1357, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/spank/OneDrive/Desktop/PoP/frontend/src/app/studio/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useWebRTC } from '@/hooks/useWebRTC';\r\nimport { VideoGrid } from '@/components/studio/VideoGrid';\r\nimport { Editor } from '@/components/studio/Editor';\r\nimport { Button } from '@/components/ui/Button';\r\nimport { useRecorder } from '@/hooks/useRecorder';\r\nimport { Mic, Video, MonitorUp, PhoneOff, Circle, MicOff, VideoOff } from 'lucide-react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function StudioPage() {\r\n    const router = useRouter();\r\n    // Hardcoded room for demo 'main-studio'\r\n    // In real app, this would come from params\r\n    const {\r\n        localStream,\r\n        peers,\r\n        socket,\r\n        error,\r\n        toggleAudio,\r\n        toggleVideo,\r\n        isAudioEnabled,\r\n        isVideoEnabled,\r\n        shareScreen,\r\n        stopScreenShare,\r\n        isScreenSharing\r\n    } = useWebRTC('main-studio');\r\n    const { isRecording, startRecording, stopRecording, recordedChunks } = useRecorder();\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[50vh] text-center p-8 space-y-4\">\r\n                <div className=\"p-4 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full\">\r\n                    <Video className=\"w-12 h-12\" />\r\n                </div>\r\n                <h2 className=\"text-2xl font-bold\">Camera/Microphone Access Denied</h2>\r\n                <p className=\"text-gray-600 dark:text-gray-400 max-w-md\">\r\n                    We couldn't access your camera or microphone. This is usually because:\r\n                </p>\r\n                <ul className=\"text-left bg-gray-50 dark:bg-zinc-900 p-6 rounded-xl space-y-2 border border-gray-200 dark:border-white/10\">\r\n                    <li className=\"flex items-center gap-2\">1. You denied permission in the browser popup.</li>\r\n                    <li className=\"flex items-center gap-2\">2. Your operating system/settings have blocked access.</li>\r\n                    <li className=\"flex items-center gap-2\">3. Another application is using the camera.</li>\r\n                </ul>\r\n                <div className=\"text-xs text-red-500 font-mono bg-red-50 dark:bg-red-900/10 p-2 rounded\">\r\n                    Error Details: {error.name}: {error.message}\r\n                </div>\r\n                <div className=\"flex gap-4 pt-4\">\r\n                    <Button onClick={() => window.location.reload()}>Try Again</Button>\r\n                    <Button variant=\"ghost\" onClick={() => router.push('/')}>Go Back</Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const handleRecordToggle = () => {\r\n        if (isRecording) {\r\n            stopRecording();\r\n        } else {\r\n            if (localStream) startRecording(localStream);\r\n        }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        // Cleanup handled by hook unmount, just navigate away\r\n        router.push('/');\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-[calc(100vh-8rem)] gap-4\">\r\n            {/* Header / Toolbar (optional specific to studio) */}\r\n            <div className=\"flex items-center justify-between px-2\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-500\">\r\n                        Live Studio\r\n                    </h1>\r\n                    <p className=\"text-sm text-gray-500\">Room: main-studio</p>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    <div className=\"px-3 py-1 rounded-full bg-red-500/10 text-red-500 text-xs font-semibold animate-pulse\">\r\n                         Live\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Grid */}\r\n            <div className=\"flex-1 bg-gray-100 dark:bg-zinc-900/50 rounded-3xl border border-white/20 overflow-hidden relative\">\r\n                <VideoGrid peers={peers} />\r\n            </div>\r\n\r\n            {/* Bottom Controls */}\r\n            <div className=\"flex items-center justify-center gap-4 py-4\">\r\n                {/* ... existing controls ... */}\r\n                <Button\r\n                    variant={isAudioEnabled ? \"secondary\" : \"danger\"}\r\n                    size=\"lg\"\r\n                    className=\"rounded-full shadow-md transition-all\"\r\n                    onClick={toggleAudio}\r\n                >\r\n                    {isAudioEnabled ? <Mic className=\"w-5 h-5\" /> : <MicOff className=\"w-5 h-5\" />}\r\n                </Button>\r\n                <Button\r\n                    variant={isVideoEnabled ? \"secondary\" : \"danger\"}\r\n                    size=\"lg\"\r\n                    className=\"rounded-full shadow-md transition-all\"\r\n                    onClick={toggleVideo}\r\n                >\r\n                    {isVideoEnabled ? <Video className=\"w-5 h-5\" /> : <VideoOff className=\"w-5 h-5\" />}\r\n                </Button>\r\n                <Button\r\n                    variant={isScreenSharing ? \"danger\" : \"primary\"}\r\n                    size=\"lg\"\r\n                    className=\"rounded-full px-8 shadow-xl shadow-indigo-500/20\"\r\n                    onClick={isScreenSharing ? stopScreenShare : shareScreen}\r\n                >\r\n                    <MonitorUp className={`w-5 h-5 mr-2 ${isScreenSharing ? 'animate-pulse' : ''}`} />\r\n                    {isScreenSharing ? 'Stop Sharing' : 'Share Screen'}\r\n                </Button>\r\n                <Button variant={isRecording ? 'danger' : 'secondary'} size=\"lg\" className=\"rounded-full shadow-md transition-all\" onClick={handleRecordToggle}>\r\n                    <Circle className={`w-5 h-5 ${isRecording ? 'fill-current animate-pulse' : ''}`} />\r\n                </Button>\r\n                <Button variant=\"danger\" size=\"lg\" className=\"rounded-full shadow-md\" onClick={handleLeave}>\r\n                    <PhoneOff className=\"w-5 h-5 md:mr-2\" /> <span className=\"hidden md:inline\">Leave</span>\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Editor Section */}\r\n            {!isRecording && recordedChunks.length > 0 && <Editor recordedChunks={recordedChunks} />}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}